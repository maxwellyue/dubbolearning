
内容来自：[Dubbo在电商开发中的应用](https://yq.aliyun.com/articles/109976?spm=5176.10695662.1996646101.searchclickresult.47605201U7pPYG)


---
### 一、Dubbo背景

所谓背景介绍，就是“我们在什么情况下，基于什么原因开发了这样一个中间件？”简而言之，总结如下:

(1) 随着服务的不断增多，服务的URL配置管理变得非常困难。此时，我们需要找一个中介替我们管理。

(2) 服务间的依赖关系变得错踪复杂，相互调用混乱。此时，我们需要厘清谁是服务提供方，谁是服务的消费方。

(3) 服务间的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？此时，我们需要有一个自动监控系统，帮助我们监控管理这一切。

基于以上三点，我们再做一个进一步提取：

我们需要一个管理众多服务URL的中介 ——注册中心；

我们需要搞清服务间复杂的依赖关系 ——服务提供方和服务消费方；

我们需要有一个自动监控系统，监管一切 ——监控中心。

如此，我们Dubbo的模型就自然而然的出来了。


---
### 二、Dubbo简介

Dubbo是Alibaba开源的分布式服务框架，它最大的特点是按照分层的方式来架构，

使用这种方式可以使各个层之间解耦合（或者最大限度地松耦合），比如表现层和业务层就需要解耦合。

从面向服务的角度来看，Dubbo采用的是一种非常简单的模型，

要么是提供方提供服务，要么是消费方消费服务，

所以基于这一点可以抽象出服务提供方（Provider）和服务消费方（Consumer）两个角色。

除了以上两个角色，

它还有注册中心和监控中心。

它可以通过注册中心对服务进行注册和订阅，实现了软负载均衡和Failover（故障切换），降低对F5硬件负载均衡器的依赖，也能减少部分成本。

同时，还可以通过监控中心对服务进行监控，这样的话，就可以知道哪些服务使用率高、哪些服务使用率低。

对使用率高的服务增加机器，对使用率低的服务减少机器，达到合理分配资源的目的。

![Dubbo架构图.png](http://dubbo.io/images//dubbo-architecture.png)

上图中调用关系说明：

0：服务容器负责启动，加载，运行服务提供者。

1：服务提供者在启动时，向注册中心注册自己提供的服务。

2：服务消费者在启动时，向注册中心订阅自己所需的服务。

3：注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。

4：服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。

5：服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。


### 三、注册中心

注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小。

Dubbo目前支持4种注册中心,（multicast、zookeeper、redis、simple），

但是对于dubbo-2.3.3以上版本，建议使用Zookeeper注册中心。

###### Zookeeper简介

Zookeeper是Apacahe Hadoop的子项目，是一个树型的目录服务，支持变更推送，适合作为Dubbo服务的注册中心，工业强度较高，可用于生产环境，并推荐使用。

![](http://img.blog.csdn.net/20161109153623671)

流程说明：

①服务提供者启动时：向`/dubbo/com.foo.BarService/providers`目录下写入自己的URL地址。

②服务消费者启动时：订阅`/dubbo/com.foo.BarService/providers`目录下的提供者URL地址，并向`/dubbo/com.foo.BarService/consumers`目录下写入自己的URL地址。

③监控中心启动时：订阅`/dubbo/com.foo.BarService`目录下的所有提供者和消费者URL地址。

支持以下功能：

①当提供者出现断电等异常停机时，注册中心能自动删除提供者信息。

②当注册中心重启时，能自动恢复注册数据，以及订阅请求。

③当会话过期时，能自动恢复注册数据，以及订阅请求。

④当设置`<dubbo:registry check="false" />`时，记录失败注册和订阅请求，后台定时重试。

⑤可通过`<dubbo:registry username="admin" password="1234" />`设置`zookeeper`登录信息。

⑥可通过`<dubbo:registry group="dubbo" />`设置`zookeeper`的根节点，不设置将使用无根树。

⑦支持`*`号通配符`<dubbo:reference group="*" version="*" />`，可订阅服务的所有分组和所有版本的提供者

